{% extends "fetch_data\base.html" %}
{% load static %}

{% block head-static %}
<script type="text/javascript" src="{% static 'jquery-3.7.1.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/fetch_data/mytasks.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'css/fetch_data/mytasks.css' %}">
{% endblock %}

{% block body %}

<div class="container">
<div class="row" style="padding: 25px; border-radius: 25px; background-color: #ffffff; margin: 6px">
    <div class="col-12" style="background-color: #ffffff ; padding: 50px; border-radius: 25px;">
        <table class="table">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Type</th>
                <th scope="col">Status</th>
                <th scope="col">Progress</th>
                <th scope="col">Request time</th>
            </tr>
            </thead>
            {% for task in tasks %}
            <tr data-toggle="collapse" data-target=".details-row">
                <td>{{ forloop.counter }}</td>
                {% if task.task_type == "fetch" %}
                    <td>Fetch</td>
                {% elif task.task_type == "fetch_infer" %}
                    <td>Fetch & Inference</td>
                {% elif task.task_type == "infer" %}
                    <td>Inference</td>
                {% endif %}

                {% if task.task_status == "fetching" %}
                    <td>Fetch in progress</td>
                {% elif task.task_status == "fetched" %}
                    <td>Fetching completed</td>
                {% elif task.task_status == "inferencing" %}
                    <td>Inference in progress</td>
                {% elif task.task_status == "inferenced" %}
                    <td>Inferencing completed</td>
                {% endif %}

                <td>{{ task.fetch_progress }}%</td>
                <td>{{ task.time_queued }}</td>
            </tr>
            <tr class="collapse details-row">
            <td colspan="5">
                <div class="details-content">
                    <p>Lon: <span class="lonlat">{{task.lon_min|floatformat:4 }}</span> to <span class="lonlat">{{task.lon_max|floatformat:4}}</span>
                    &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp X: <span class="lonlat">{{task.x_min}}</span> to <span class="lonlat">{{task.x_max}}</span>
                    &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp Zoom: <span class="lonlat">{{task.zoom}}</span>
                    &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp From <span class="date">{{task.time_from}}</span> to <span class="date">{{task.time_to}}</span>
                    </p>
                    <p>Lat:  <span class="lonlat">{{task.lat_min|floatformat:4}}</span>  to <span class="lonlat">{{task.lat_max|floatformat:4}}</span>
                    &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp Y: <span class="lonlat">{{task.y_min}}</span> to <span class="lonlat">{{task.y_max}}</span>
                    </p>
                </div>
            </td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>
{% endblock %}