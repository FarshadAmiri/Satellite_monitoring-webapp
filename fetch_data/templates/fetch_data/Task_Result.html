{% extends "fetch_data\base.html" %}
{% load static %}
{% load mathfilters %}

{% block head-title %}
    <title>Task result</title>
{% endblock %}

{% block head-static %}
<script type="text/javascript" src="{% static 'jquery-3.7.1.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/fetch_data/task_result.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'css/fetch_data/task_result.css' %}">
{% endblock %}

{% block body %}

<div class="container">
{% if messages %}
    {% for message in messages %}
        <div class="alert alert-danger" role="alert">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}
<div class="row" style="padding: 25px; border-radius: 25px; background-color: #ffffff; margin: 6px">
    <div class="col-12" style="background-color: #ffffff ; padding: 20px; padding-bottom: 10px; border-radius: 25px;">
        <p>This fetch reuested by <span class="username">@{{ task.user_queued}}</span> at <span class="info">{{ task.time_queued }}</span>
        &nbsp &nbsp &nbsp Area tag: <span class="lonlat">{% for area_tag in task.area_tag.all %}{{ area_tag }}{% if not forloop.last %}, {% endif %}{% endfor %}
        </span> &nbsp &nbsp &nbsp Lon: <span class="lonlat">{{ task.lon_min|floatformat:4 }}</span> to <span class="lonlat">{{ task.lon_max|floatformat:4 }}</span> &nbsp &nbsp &nbsp Lat: <span class="lonlat">{{ task.lat_min|floatformat:4 }}</span> to <span class="lonlat">{{ task.lat_max|floatformat:4 }}</span>
        </p>
        <h5>Fetch progress: <span class="result-meta-green">{{ task.fetch_progress }}%</span>&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp <span class="result-meta">{{ objects|length }}</span> Objects  &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp Status: {% if task.task_status == "fetching" %}<span>Fetch in progress</span>{% elif task.task_status == "fetched" %}<span>Fetching completed</span>{% elif task.task_status == "inferencing" %}<span>Inference in progress</span>{% elif task.task_status == "inferenced" %}<span>Inferencing completed</span>{% endif %}</h5>
        <a class="btn btn-primary" href="{% url 'fetch_data:image_concat' 'normal' task.task_id %}">Area's image</a>
        <a class="btn btn-success" href="{% url 'fetch_data:image_concat' 'annot' task.task_id %}">Area's image + annotations</a>
        {% comment %} <button class="btn btn-secondary" onclick="{% url 'fetch_data:image_concat' 'normal' task.task_id %}">Concat</button> {% endcomment %}
        {% comment %} <button class="btn btn-primary" onclick="{% url 'fetch_data:image_concat' 'annot' task.task_id %}">Concat - annotated</button> {% endcomment %}
        <table class="table">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Watercraft type</th>
                <th scope="col">Length</th>
                <th scope="col">Awake</th>
                <th scope="col">Confidence</th>
                <th scope="col">Lon</th>
                <th scope="col">Lat</th>
                <th scope="col">Image</th>
            </tr>
            </thead>
            {% for obj in objects %}
            <tr data-toggle="collapse" data-target=".details-row">
                <td>{{ forloop.counter }}</td>
                <td>{{ obj.object_type }}</td>
                <td>{{ obj.length }}</td>
                <td>{{ obj.awake }}</td>
                <td>{{ obj.confidence|mul:100|floatformat:1 }}%</td>
                <td>{{ obj.lon|floatformat:6}}</td>
                <td>{{ obj.lat|floatformat:6 }}</td>
                {% comment %} <td><a class="image-link" href="../../static/icons/main_icon.png">image</a></td> {% endcomment %}
                {% comment %} <td><a class="image-link" href="../../SatteliteImages_db/14/10757/6918/2023-11-17_2023-11-27_annotated.png">image</a></td> {% endcomment %}
                {% comment %} <td><a class="image-link" href="https://cdn.shopify.com/s/files/1/2018/8867/files/matteo-paganelli-39971_530x.jpg">image</a></td> {% endcomment %}
                <td><a href="{% url 'fetch_data:image_get' task.task_id obj.image %}">Image</a></td>
                {% comment %} <td><img src="{% url 'fetch_data:image_get' obj.image %}" style="height:35px; width:54px"></a></td> {% endcomment %}
                {% comment %} <td><img src="{{ obj.image }}">image</a></td> {% endcomment %}
                {% comment %} <td>{{ obj.image }}</td> {% endcomment %}
            </tr>
            <tr class="collapse details-row">
            <td colspan="5">
                <div class="details-content">
                    <p>X: <span class="lonlat">{{obj.image__x}}</span>
                    &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp Y: <span class="lonlat">{{obj.image__y}}</span>
                    &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp Zoom: <span class="lonlat">{{obj.image__zoom}}</span>
                    &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp Area tag: <span class="lonlat">{{obj.image__area_tag}}</span>
                    </p>
                </div>
            </td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>
{% endblock %}